@{
    ViewBag.Title = "Home Page";
}

<div class="row">
    @*<div class="col-md-6 grid-margin stretch-card">
            <div class="card tale-bg">
                <div class="card-people mt-auto">
                    <img src="~/Content/assets/images/dashboard/people.svg" alt="people">
                    <div class="weather-info">
                        <div class="d-flex">
                            <div>
                                <h2 class="mb-0 font-weight-normal"><i class="icon-sun mr-2"></i>31<sup>C</sup></h2>
                            </div>
                            <div class="ml-2">
                                <h4 class="location font-weight-normal">Bangalore</h4>
                                <h6 class="font-weight-normal">India</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@
    <div class="col-md-6 grid-margin transparent">
        <div class="row">
            <div class="col-md-6 mb-4 stretch-card transparent">
                <div class="card card-tale">
                    <div class="card-body">
                        <p class="mb-4">Total Bookings</p>
                        <p class="fs-30 mb-2 mdi mdi-hotel">  @ViewBag.lentenant</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4 stretch-card transparent">
                <div class="card card-dark-blue">
                    <div class="card-body">
                        <p class="mb-4">Total Rooms Available</p>
                        <p class="fs-30 mb-2 mdi mdi-home-map-marker">  @ViewBag.lenroom</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 grid-margin transparent">
        <div class="row">
            <div class="col-md-6 mb-4 mb-lg-0 stretch-card transparent">
                <div class="card card-light-blue">
                    <div class="card-body">
                        <p class="mb-4">Total Inflow</p>
                        <p class="fs-30 mb-2">  RM @ViewBag.TotalInflow</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 stretch-card transparent">
                <div class="card card-light-danger">
                    <div class="card-body">
                        <p class="mb-3">Monthly Attendance</p>
                        <p class="fs-30 mb-2 mdi mdi-calendar-check">  Total: @ViewBag.TotalAttendance</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <p class="card-title">Finance Details</p>
                <div class="d-flex flex-wrap mb-5">
                    <div class="mr-5 mt-3">
                        <p class="text-muted">Total Profit</p>
                        <h3 class="text-primary fs-30 font-weight-medium">@ViewBag.TotalProfit</h3>
                    </div>
                    <div class="mr-5 mt-3">
                        <p class="text-muted">Profit Percentage</p>
                        <h3 class="text-primary fs-30 font-weight-medium">@ViewBag.PercentProfit%</h3>
                    </div>
                </div>
                <canvas id="pieChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-8 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <p class="card-title">Landlord Reminder</p>
                </div>
                <div class="table-responsive">
                    <table id="dataTable2" class="display expandable-table dataTable no-footer" style="width:100%" role="grid">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Bank Account</th>
                                <th>Fee</th>
                                <th>Payment Due</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var landlord in ViewBag.landlord)
                            {
                                var phoneNum = landlord.l_phone;
                                var encodedMsg = "Dear " + landlord.l_name + ", an amount of RM" + landlord.l_fee + " have been credited to your bank account " + landlord.l_bank + ". Please kindly check your bank account. Thank You.";
                                var whatsapp = "https://wa.me/+6" + phoneNum + "?text=" + encodedMsg;
                                <tr>
                                    <td>@landlord.l_name</td>
                                    <td>@landlord.l_bank</td>
                                    <td>@landlord.l_fee</td>
                                    <td>@landlord.l_due.ToString("dd-MM-yyyy")</td>
                                    <td style="text-align: center">
                                        <a href="@whatsapp" target="_blank" class="btn btn-info mdi mdi-whatsapp"></a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <p class="card-title">Tenant with <strong>Unpaid</strong> status that exceed check out date.</p>
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table id="dataTable" class="display expandable-table dataTable no-footer" style="width:100%" role="grid">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Check In</th>
                                        <th>Check Out</th>
                                        <th>Outstanding</th>
                                        <th>Room No</th>
                                        <th>Reminder</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var tenant in ViewBag.tenant)
                                    {
                                        var phoneNumber = tenant.t_phone;
                                        var encodedMessage = "Dear " + tenant.t_name + ", Please kindly pay the rental fee (RM" + tenant.t_outstanding + ") for last month. Thank You.";
                                        var whatsappUrl = "https://wa.me/+6" + phoneNumber + "?text=" + encodedMessage;
                                        <tr>
                                            <td>@tenant.t_name</td>
                                            <td>@tenant.t_phone</td>
                                            <td>@tenant.t_indate.ToString("dd-MM-yyyy")</td>
                                            <td>@tenant.t_outdate.ToString("dd-MM-yyyy")</td>
                                            <td style="text-align: center">@tenant.t_outstanding</td>
                                            <td style="text-align: center">@tenant.t_room</td>
                                            <td style="text-align: center">
                                                <a href="@whatsappUrl" target="_blank" class="btn btn-success mdi mdi-whatsapp"></a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <p class="card-title">Room Available</p>
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table id="dataTable3" class="display expandable-table dataTable no-footer" style="width:100%" role="grid">
                                <thead>
                                    <tr>
                                        <th>Floor No</th>
                                        <th>Room No</th>
                                        <th>Price</th>
                                        <th style="text-align: center">Room Size</th>
                                        <th>Active</th>
                                        <th style="text-align: center">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var room in ViewBag.room)
                                    {
                                        <tr>
                                            <td>@room.r_floor</td>
                                            <td>@room.r_no</td>
                                            <td>@room.r_price</td>
                                            <td style="text-align: center">@room.r_size</td>
                                            <td style="text-align: center">@room.r_active</td>
                                            <td style="text-align: center">
                                                <a href="@Url.Action("Edit", "Room", new { id = room.r_id })" class="btn btn-link" title="edit">
                                                    <i class="fa fa-edit text-primary"></i>
                                                </a>
                                                <a href="@Url.Action("Details", "Room", new { id = room.r_id })" class="btn btn-link" title="details">
                                                    <i class="fa fa-info-circle text-info"></i>
                                                </a>
                                                <a href="@Url.Action("Delete", "Room", new { id = room.r_id })" class="btn btn-link" title="delete">
                                                    <i class="fa fa-trash text-danger"></i>
                                                </a>

                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            jQuery('#dataTable').DataTable();
            jQuery('#dataTable2').DataTable();
            jQuery('#dataTable3').DataTable();
        });

        // Prepare the data for the pie chart
        var labels = ['Inflow', 'Outflow'];
        var values = [@ViewBag.TotalInflow, @ViewBag.TotalOutflow];
        var colors = ['green', 'red']; // Specify the colors for each segment

        // Calculate the total value for percentage calculation
        var totalValue = values.reduce((a, b) => a + b, 0);

        // Calculate the percentage for each value
        var percentages = values.map(value => ((value / totalValue) * 100).toFixed(2) + '%');

        // Create the pie chart
        var ctx = document.getElementById('pieChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: colors
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var dataset = data.datasets[tooltipItem.datasetIndex];
                            var value = dataset.data[tooltipItem.index];
                            var percentage = percentages[tooltipItem.index];
                            return value + ' (' + percentage + ')';
                        }
                    }
                }
            }
        });
    </script>
}