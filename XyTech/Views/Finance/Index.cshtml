@model IEnumerable<XyTech.Models.tb_finance>

<h2>Finance</h2>

<p>
    @Html.ActionLink("New Transaction", "Create")
</p>
<div class="card">
    <div class="card-body">
        <div class="table-responsive pt-3">
            <table class="table table-bordered">
                <tr>
                    <th>
                        Year
                    </th>
                    <th>
                        Month
                    </th>
                    <th>
                        Day
                    </th>
                    <th>
                        Inflow
                    </th>
                    <th>
                        Outflow
                    </th>
                    <th>
                        Bank/Cash
                    </th>
                    <th>
                        Details
                    </th>
                    <th>
                        Receipts
                    </th>
                    <th>
                        Floor ID
                    </th>
                    <th></th>
                </tr>
                @{
                    int previousYear = 0;
                    int previousMonth = -1;
                }

                @foreach (var item in Model)
                {
                    // Extract year, month, and day from f_date
                    var year = item.f_date.Year;
                    var month = item.f_date.Month;
                    var day = item.f_date.Day;
                    <tr>
                        @{
                            if (year == previousYear)
                            {
                                <td rowspan="2">@year</td>
                            }
                            else
                            {
                                <td>@year</td>
                            }

                            if (month == previousMonth)
                            {
                                <td rowspan="2">@month</td>
                            }
                            else
                            {
                                <td>@month</td>
                            }
                        }
                        <td>
                            @day
                        </td>
                        <td>
                            @if (item.f_transactiontype == "Inflow")
                            {
                                <span id="inflowAmount">@item.f_transaction</span>
                            }
                        </td>
                        <td>
                            @if (item.f_transactiontype == "Outflow")
                            {
                                <span id="inflowAmount">@item.f_transaction</span>
                            }
                        </td>

                        <td>
                            @Html.DisplayFor(modelItem => item.f_paymentmethod)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.f_desc)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.f_receipt)
                        </td>

                        @if (item.tb_floor?.fl_id == null)
                        {
                            <td>
                                General
                            </td>
                        }
                        else
                        {
                            <td>
                                @Html.DisplayFor(modelItem => item.tb_floor.fl_id)
                            </td>
                        }

                        <td>
                            @Html.ActionLink("Edit", "Edit", new { id = item.f_id }) |
                            @Html.ActionLink("Details", "Details", new { id = item.f_id }) |
                            @Html.ActionLink("Delete", "Delete", new { id = item.f_id })
                        </td>
                    </tr>
                }

            </table>
        </div>
    </div>
</div>

<script>
    // Format the inflow and outflow amounts with 2 decimal places
    var inflowAmount = document.getElementById("inflowAmount");
    if (inflowAmount) {
        inflowAmount.textContent = parseFloat(inflowAmount.textContent).toFixed(2);
    }

    function GetRowColor(transactionType) {
        if (transactionType === "Inflow") {
            return "inflow-row";
        }
        else if (transactionType === "Outflow") {
            return "outflow-row";
        }
        else {
            return ""; // Default row color
        }
    }
</script>

<style>
    .inflow-row {
        background-color: lightgreen;
    }

    .outflow-row {
        background-color: lightcoral;
    }
</style>







